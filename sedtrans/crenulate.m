% Calculate equilibrium crenulate bay planform using Silvester & Hsu 

function coords = crenulate(beta,coord_A,coord_B,dtheta)

coeff = [20 0.054 1.04 -0.094;
        22 0.054 1.053 -0.109;
        24 0.054 1.069 -0.125;
        26 0.052 1.088 -0.144;
        28 0.080 1.110 -0.164;
        30 0.046 1.136 -0.186;
        32 0.041 1.166 -0.210;
        34 0.034 1.199 -0.237;
        36 0.026 1.236 -0.265;
        38 0.015 1.277 -0.296;
        40 0.003 1.322 -0.328;
        42 -0.011 1.370 -0.362;
        44 -0.027 1.422 -0.398;
        46 -0.045 1.478 -0.435;
        48 -0.066 1.537 -0.473;
        50 -0.088 1.598 -0.512;
        52 -0.112 1.662 -0.552;
        54 -0.138 1.729 -0.592;
        56 -0.166 1.797 -0.632;
        58 -0.196 1.866 -0.671;
        60 -0.227 1.936 -0.710;
        62 -0.260 2.006 -0.746;
        64 -0.295 2.076 -0.781;
        66 -0.331 2.145 -0.813;
        68 -0.368 2.212 -0.842;
        70 -0.405 2.276 -0.867;
        72 -0.444 2.336 -0.888;
        74 -0.483 2.393 -0.903;
        76 -0.522 2.444 -0.912;
        78 -0.561 2.489 -0.915;
        80 -0.600 2.526 -0.910];
if beta<20||beta>80, warning('beta outside range (20-80)'), end
theta = (beta:dtheta:180+beta)';
C = interp1(coeff(:,1),coeff(:,2:4),beta);
R0 = sqrt((coord_B(1)-coord_A(1))^2+(coord_B(2)-coord_A(2))^2);
theta0 = atan2(coord_B(2)-coord_A(2),coord_B(1)-coord_A(1))/pi*180;
R = R0 * (C(1)+C(2)*(beta./theta)+C(3)*(beta./theta).^2);
coords = zeros(size(theta,1),2);
coords(:,1) = coord_A(1) + R.*cos((theta0-(theta-beta))/180*pi);
coords(:,2) = coord_A(2) + R.*sin((theta0-(theta-beta))/180*pi);